-- CVE-2024-26817

I found a security vulnerability in AMD KFD in the following file `drivers/gpu/drm/amd/amdkfd/kfd_chardev.c`, the ioctl identifier is AMDKFD_IOC_GET_PROCESS_APERTURES_NEW.
In the function `kfd_ioctl_get_process_apertures_new`, the user-provided data of args->num_of_nodes will be multiplied and passed directly to kzalloc and that could lead to integer overflow in some platforms.
That would allocate a small size and potentially corrupt the heap just after in the same function.

Description
===========

In the Linux kernel, the following vulnerability has been resolved:

amdkfd: use calloc instead of kzalloc to avoid integer overflow

This uses calloc instead of doing the multiplication which might
overflow.

The Linux kernel CVE team has assigned CVE-2024-26817 to this issue.


Affected and fixed versions
===========================

	Fixed in 4.19.312 with commit e6721ea845fc
	Fixed in 5.4.274 with commit 8b0564704255
	Fixed in 5.10.215 with commit fcbd99b3c733
	Fixed in 5.15.155 with commit cbac7de1d990
	Fixed in 6.1.86 with commit e6768c6737f4
	Fixed in 6.6.27 with commit 315eb3c2df7e
	Fixed in 6.8.6 with commit 0c33d1115394

Please see https://www.kernel.org for a full list of currently supported
kernel versions by the kernel community.

Unaffected versions might change over time as fixes are backported to
older supported kernel versions.  The official CVE entry at
	https://cve.org/CVERecord/?id=CVE-2024-26817
will be updated if fixes are backported, please check that for the most
up to date information about this issue.


Affected files
==============

The file(s) affected by this issue are:
	drivers/gpu/drm/amd/amdkfd/kfd_chardev.c


Mitigation
==========

The Linux kernel CVE team recommends that you update to the latest
stable kernel version for this, and many other bugfixes.  Individual
changes are never tested alone, but rather are part of a larger kernel
release.  Cherry-picking individual commits is not recommended or
supported by the Linux kernel community at all.  If however, updating to
the latest release is impossible, the individual changes to resolve this
issue can be found at these commits:
	https://git.kernel.org/stable/c/e6721ea845fcb93a764a92bd40f1afc0d6c69751
	https://git.kernel.org/stable/c/8b0564704255c6b3c6a7188e86939f754e1577c0
	https://git.kernel.org/stable/c/fcbd99b3c73309107e3be71f20dff9414df64f91
	https://git.kernel.org/stable/c/cbac7de1d9901521e78cdc34e15451df3611f2ad
	https://git.kernel.org/stable/c/e6768c6737f4c02cba193a3339f0cc2907f0b86a
	https://git.kernel.org/stable/c/315eb3c2df7e4cb18e3eacfa18a53a46f2bf0ef7
	https://git.kernel.org/stable/c/0c33d11153949310d76631d8f4a4736519eacd3a
